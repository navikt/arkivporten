meta {
  name: Hent dokument for systembruker
  type: http
  seq: 1
}

get {
  url: {{baseUrlEkstern}}/api/v1/documents/{{lenkeId}}
  body: none
  auth: bearer
}

auth:bearer {
  token: eyJraWQiOiJiZFhMRVduRGpMSGpwRThPZnl5TUp4UlJLbVo3MUxCOHUxeUREbVBpdVQwIiwiYWxnIjoiUlMyNTYifQ.eyJhdXRob3JpemF0aW9uX2RldGFpbHMiOlt7InR5cGUiOiJ1cm46YWx0aW5uOnN5c3RlbXVzZXIiLCJzeXN0ZW11c2VyX29yZyI6eyJhdXRob3JpdHkiOiJpc282NTIzLWFjdG9yaWQtdXBpcyIsIklEIjoiMDE5MjozMTExMzE3ODgifSwic3lzdGVtdXNlcl9pZCI6WyI3ZmJjODU5MC02YjM0LTQ4NTItOWFlMi05OTI3MmQ2ZTAwODAiXSwic3lzdGVtX2lkIjoiMjE1NjQ5MjAyX2twZlN5cyJ9XSwic2NvcGUiOiJuYXY6c3lmby9kb2t1bWVudHBvcnRlbiIsImlzcyI6Imh0dHBzOi8vdGVzdC5tYXNraW5wb3J0ZW4ubm8vIiwiY2xpZW50X2FtciI6InByaXZhdGVfa2V5X2p3dCIsInRva2VuX3R5cGUiOiJCZWFyZXIiLCJleHAiOjE3NjU4OTgzMTksImlhdCI6MTc2NTg5ODE5OSwiY2xpZW50X2lkIjoiMjFhZTNkZTEtZWZlYS00ZWVkLWExMTYtMGYxNTNhNWQ5OWZkIiwianRpIjoiRmhCQTJOcVhOMnJxQ3c1THNHbDFQLXNUQU5NazJiNkFGSm9MVVFIaDA4cyIsImNvbnN1bWVyIjp7ImF1dGhvcml0eSI6ImlzbzY1MjMtYWN0b3JpZC11cGlzIiwiSUQiOiIwMTkyOjIxNTY0OTIwMiJ9fQ.VEQOY0n35NxkC-aRdZfAIhu6g8R_xSTGrXhMkO_EzM6NhBeLi9QooTJtqSyPp39uYwYrtBqbGpCbNqSY6gvsG41zKEQ2l_--0l8WyLHnbo29XZV_REjRW9Ivd0sreXsJjeztPnOFDO2jfIV-aub-Vsf2GQX4XnIOTivB6bVQymW59D-HvzcGpzvWo_TAObIHd8Z0RW7P-c3KfsqVmWR3q_CZA7mjNx9uRtyXLWwKPYh9A_kJoaEvOssHsYk_cc-5oHjesdVr2bHMzsw2bOwN8T6khc3eRFFznGzXWH7auZu1T3PX04E99eqtxvFRqWuOIxnh08_jLvUQ6PPoM8Y8F4HXGZtr0bwD4G40ImQLmFOczCnmwi2aEe76ckGRJlk8E_s5YUomC0UXsxffR6DS5u_9V7aPNE4JAtuzNfCd-61IvV-Qlkde1RF4Bs8EVhr2YU-JPGyhMLPTvS2anXnXsX8w2sy_67aL_wDIyshJhnEeDdMF8WtDi9bRS53VE66q
}

vars:pre-request {
  lenkeId: c14bf518-a59e-466e-8311-3bd46d6fbe46
  baseUrlEkstern: https://syfo-dokumentporten.ekstern.dev.nav.no
}

script:pre-request {
  const http = require("axios");
  
  if (bru.getEnvName() === "local") {
    if (!bru.hasEnvVar("token")) {
      throw new Error("Kjør request 'mock maskinporten token' først for å teste lokalt");
    }
    const token = bru.getEnvVar("token");
    req.setHeader("Authorization", "Bearer "+ token);
    
  } else {
    const systembrukerOrgnr = bru.getEnvVar("systemKundeOrgnr");
    const tokenrespons = await http.get("https://esyfo-token.intern.dev.nav.no/systembruker/" + systembrukerOrgnr);
    req.setHeader("Authorization", "Bearer "+ tokenrespons.data);
  }
}

settings {
  encodeUrl: true
  timeout: 0
}
